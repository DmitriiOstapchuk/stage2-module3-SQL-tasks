with total_avg_mark (total_avg_mark) as (select AVG(mark) from mark), subject_avg_mark (subject_id, avg_mark) as (select subject_id, avg(mark) from mark group by subject_id) select s.* from total_avg_mark tam, subject s join subject_avg_mark sam on sam.subject_id = s.id where sam.avg_mark > tam.total_avg_mark;
with student_payment(student_id, average_for_student) as (select student_id, avg(amount) from payment group by student_id), avg_payment(average_payment) as (select avg(average_for_student) from student_payment) select s.* from avg_payment ap, student s join student_payment sp on sp.student_id = s.id where sp.average_for_student < ap.average_payment;